<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nuoxin.virtual.rep.api.mybatis.EmailMapper">

    <select id="getTodayEmailNum" parameterType="com.nuoxin.virtual.rep.api.web.controller.request.WorkStationRequestBean"
            resultType="java.lang.Integer">

        select count(distinct vei.doctor_id)
        from virtual_email_info vei
        inner join doctor d
        on vei.doctor_id = d.id
        inner join drug_user_doctor dud
        on d.id = dud.doctor_id
        inner join drug_user du
        on dud.drug_user_id = du.id
        where vei.product_id = #{productId}
        and date_format(vei.create_time,'%Y-%m-%d')=date_format(NOW(),'%Y-%m-%d')
        and dud.prod_id = #{productId}
        and du.leader_path like #{leaderPath}
    </select>


    <select id="getTodayEmailCount" parameterType="com.nuoxin.virtual.rep.api.web.controller.request.WorkStationRequestBean"
            resultType="java.lang.Integer">

        select count(distinct vei.id)
        from virtual_email_info vei
        inner join doctor d
        on vei.doctor_id = d.id
        inner join drug_user_doctor dud
        on d.id = dud.doctor_id
        inner join drug_user du
        on dud.drug_user_id = du.id
        where vei.product_id = #{productId}
        and date_format(vei.create_time,'%Y-%m-%d')=date_format(NOW(),'%Y-%m-%d')
        and dud.prod_id = #{productId}
        and du.leader_path like #{leaderPath}
    </select>
</mapper>