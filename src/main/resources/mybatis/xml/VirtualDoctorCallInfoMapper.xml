<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nuoxin.virtual.rep.api.mybatis.VirtualDoctorCallInfoMapper">

	<select id="getCallVisitCount" resultType="java.lang.Integer">
		SELECT 
			count(*)
		FROM virtual_doctor_call_info
		WHERE 
			virtual_doctor_id=#{virtualDoctorId}
			AND virtual_drug_user_id IN
			<foreach collection="virtualDrugUserIds" item="virtualDrugUserId" open="(" close=")" separator=",">
		   		#{virtualDrugUserId}
		  	</foreach> 
	</select>
	
	<select id="getCallVisitList" resultType="com.nuoxin.virtual.rep.api.entity.v2_5.CallVisitBean">
		SELECT 
			id AS callId, call_time AS callTime, status_name AS statueName, call_url AS callUrl, remark, create_time AS createTime 
		FROM virtual_doctor_call_info
		WHERE 
			virtual_doctor_id=#{virtualDoctorId}
			AND virtual_drug_user_id IN
			<foreach collection="virtualDrugUserIds" item="virtualDrugUserId" open="(" close=")" separator=",">
		   		#{virtualDrugUserId}
		  	</foreach> 
		LIMIT #{currentSize}, #{pageSize}
	</select>

	<!-- 保存问卷作答 -->
	<insert id="saveVirtualDoctorCallInfo" keyProperty="callId" useGeneratedKeys="true"
		parameterType="com.nuoxin.virtual.rep.api.entity.v2_5.VirtualDoctorCallInfoParams">
		INSERT INTO virtual_doctor_call_info
		(sin_token, 
		 virtual_drug_user_id, virtual_doctor_id, doctor_questionnaire_id, product_id,
		 mobile, type, remark, status, status_name, create_time)
		VALUES
		(#{sinToken}, 
		 #{virtualDrugUserId}, #{virtualDoctorId}, #{doctorQuestionnaireId}, #{productId},
		 #{mobile}, #{type}, #{remark}, #{status}, #{statusName}, NOW())
	</insert>
	
</mapper>
