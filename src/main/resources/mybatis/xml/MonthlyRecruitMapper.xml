<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nuoxin.virtual.rep.api.mybatis.MonthlyRecruitMapper">

    <!-- 联系医院数量 -->
    <select id="getContactHospital" resultType="java.lang.Integer">
        SELECT
        COUNT( DISTINCT d.hospital_id )
        FROM
        virtual_doctor_call_info v
        INNER JOIN doctor d ON v.virtual_doctor_id = d.id
        WHERE
        v.product_id = #{productId}
        <if test="startDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &gt;= DATE_FORMAT( v.create_time, #{startDate} )
        </if>

        <if test="endDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &lt;  DATE_FORMAT( v.create_time, #{endDate} )
        </if>

    </select>


    <!-- 联系医生数量 -->
    <select id="getContactDoctor" resultType="java.lang.Integer">
        SELECT
        COUNT( DISTINCT d.id )
        FROM
        virtual_doctor_call_info v
        INNER JOIN doctor d ON v.virtual_doctor_id = d.id
        WHERE
        v.product_id = #{productId}
        <if test="startDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &gt;=  DATE_FORMAT( v.create_time, #{startDate} )
        </if>

        <if test="endDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &lt;  DATE_FORMAT( v.create_time, #{endDate} )
        </if>
    </select>



    <!-- 接触医院数量 -->
    <select id="getTouchHospital" resultType="java.lang.Integer">
        SELECT
        COUNT( DISTINCT d.hospital_id )
        FROM
        virtual_doctor_call_info v
        INNER JOIN doctor d ON v.virtual_doctor_id = d.id
        WHERE
        v.product_id = #{productId}
        AND v.status_name='answer'

        <if test="startDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &gt;=  DATE_FORMAT( v.create_time, #{startDate} )
        </if>

        <if test="endDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &lt;  DATE_FORMAT( v.create_time, #{endDate} )
        </if>


    </select>


    <!-- 接触医生数量 -->
    <select id="getTouchDoctor" resultType="java.lang.Integer">
        SELECT
        COUNT( DISTINCT d.id )
        FROM
        virtual_doctor_call_info v
        INNER JOIN doctor d ON v.virtual_doctor_id = d.id
        WHERE
        v.product_id = #{productId}
        AND v.status_name='answer'

        <if test="startDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &gt;=  DATE_FORMAT( v.create_time, #{startDate} )
        </if>
        <if test="endDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &lt;  DATE_FORMAT( v.create_time, #{endDate} )
        </if>
    </select>




    <!-- 招募医院数量 -->
    <select id="getRecruitHospital" resultType="java.lang.Integer">
        SELECT
        COUNT( DISTINCT d.hospital_id )
        FROM
        virtual_doctor_call_info v
        INNER JOIN doctor d ON v.virtual_doctor_id = d.id
        INNER JOIN virtual_doctor_call_info_mend m
        ON v.id=m.call_id
        WHERE
        v.product_id = #{productId}
        AND m.is_recruit=1
        <if test="startDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &gt;=  DATE_FORMAT( v.create_time, #{startDate} )
        </if>

        <if test="endDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &lt;  DATE_FORMAT( v.create_time, #{endDate} )
        </if>


    </select>


    <!-- 招募医生数量 -->
    <select id="getRecruitDoctor" resultType="java.lang.Integer">
        SELECT
        COUNT( DISTINCT d.id )
        FROM
        virtual_doctor_call_info v
        INNER JOIN doctor d ON v.virtual_doctor_id = d.id
        INNER JOIN virtual_doctor_call_info_mend m
        ON v.id=m.call_id
        WHERE
        v.product_id = #{productId}
        AND m.is_recruit=1
        <if test="startDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &gt;=  DATE_FORMAT( v.create_time, #{startDate} )
        </if>
        <if test="endDate !=null">
            AND DATE_FORMAT( v.create_time, '%Y-%m' ) &lt;  DATE_FORMAT( v.create_time, #{endDate} )
        </if>
    </select>


</mapper>