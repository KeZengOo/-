<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nuoxin.virtual.rep.api.mybatis.VirtualDoctorMapper">

	<select id="getVirtualDoctor" resultType="com.nuoxin.virtual.rep.api.entity.v2_5.VirtualDoctorDO">
		SELECT 
			name,
			hospital_name AS hospitalName,
			(CASE sex WHEN 'ç”·' THEN '0'  ELSE '1' END) AS gender,
			telephone AS mobile,
			positions AS title,
			depart,
			email,
			m.wechat,
			m.address,
			m.fixed_phone AS fixedPhone
		FROM doctor d
		LEFT JOIN doctor_mend m
		ON m.virtual_doctor_id = d.id
		WHERE d.id = #{virtualDoctorId}
	</select>
	
	<insert id="saveVirtualDoctors"  keyProperty="id" useGeneratedKeys="true">
		INSERT INTO doctor
		 (name, sex, telephone, drug_user_email, depart, 
		  positions, hospital_name, hospital_id, provice, city, create_time)
		VALUES 
		<foreach collection ="list" item="item" separator =",">
        	(#{item.name}, #{item.gender}, #{item.mobile}, #{item.email}, #{item.depart}, 
        	#{item.title}, #{item.hospital}, #{item.hospitalId}, #{item.province}, #{item.city}, NOW())
    	</foreach >
	</insert> 
	
	<insert id="saveVirtualDoctorMends" >
		INSERT INTO doctor_mend
		 (wechat, address, fixed_phone, virtual_doctor_id)
		VALUES 
		<foreach collection ="list" item="item" separator =",">
        	(#{item.wechat}, #{item.address}, #{item.fixedPhone}, #{item.virtualDoctorId}) 
    	</foreach >
	</insert> 
	
</mapper>